<?xml version='1.0' encoding='utf-8'?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en-us" xml:lang="en-us">

<!-- Mirrored from devlib.symbian.slions.net/belle/GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-760B503E-26E1-39CB-82C2-AE1329D0E3A4.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 27 Mar 2020 04:21:43 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="copyright" content="(C) Copyright 2005" />
<meta name="DC.rights.owner" content="(C) Copyright 2005" />
<meta name="DC.Type" content="cxxFile" />
<meta name="DC.Title" content="msg.html" />
<meta name="abstract" content="" />
<meta name="description" content="" />
<meta name="DC.Format" content="XHTML" />
<meta name="DC.Identifier" content="GUID-760B503E-26E1-39CB-82C2-AE1329D0E3A4" />
<title>msg.h</title>
<meta name="keywords" content="api" /><link rel="stylesheet" type="text/css" href="css/nokiacxxref.css" />
<link href="css/s60/style.css" rel="stylesheet" type="text/css" />
<link href="PLUGINS_ROOT/com.nokia.forum.library/css/category_cpp3.html" rel="stylesheet" type="text/css" />
<link href="PLUGINS_ROOT/com.nokia.forum.library/css/category-cover_cpp3.html" rel="stylesheet" type="text/css" /></head>
<body id="GUID-760B503E-26E1-39CB-82C2-AE1329D0E3A4"><a name="GUID-760B503E-26E1-39CB-82C2-AE1329D0E3A4"><!-- --></a><div class="body"><div class="contentLeft prTxt">
<h1 class="sectiontitle">msg.h File Reference</h1>
<div class="body refbody apiDetail apiClassifierDetail cxxFileDetail"><p class="shortdesc">
<div class="section section apiDesc section apidesc">
</div>
<div class="topic reference apiRef apiOperation cxxDefine nested1" id="GUID-9FD54EDF-AB10-3F45-A4FD-85210B85856A"><a name="GUID-9FD54EDF-AB10-3F45-A4FD-85210B85856A"><!-- --></a>
<h3 class="sectiontitle">MSG_NOERROR</h3>
<div class="body refbody apiDetail apiOperationDetail cxxDefineDetail"><p class="shortdesc">
<div class="section section apiDesc section apidesc">
<p class="p">The MSG_NOERROR identifier value, the <a class="xref" href="GUID-8CE70314-2B44-3A63-8C53-B4256F11B1EE.html#GUID-8CE70314-2B44-3A63-8C53-B4256F11B1EE">msqid_ds</a> struct and the msg struct are as defined by the SV API Intel 386 Processor Supplement. don't complain about too long msgs.</p>
</div>
</p></div>
</div>
<div class="topic reference apiRef apiValue cxxTypedef nested1" id="GUID-9BA04227-5EE7-39A1-ABEE-03F008174EEF"><a name="GUID-9BA04227-5EE7-39A1-ABEE-03F008174EEF"><!-- --></a>
<h3 class="sectiontitle">Typedef msglen_t</h3>
<div class="section signature"><table class="signature"><tr><td>typedef unsigned long</td><td>msglen_t</td></tr></table></div><div class="section section apiDesc section apidesc">
</div>
<div class="topic reference apiRef apiValue cxxTypedef nested1" id="GUID-02135CB1-F7DE-3736-91F8-E755724381C3"><a name="GUID-02135CB1-F7DE-3736-91F8-E755724381C3"><!-- --></a>
<h3 class="sectiontitle">Typedef msgqnum_t</h3>
<div class="section signature"><table class="signature"><tr><td>typedef unsigned long</td><td>msgqnum_t</td></tr></table></div><div class="section section apiDesc section apidesc">
</div>
<div class="topic reference apiRef apiValue cxxTypedef nested1" id="GUID-4A881CBD-10C9-35C6-A45B-B6B5215AC0D9"><a name="GUID-4A881CBD-10C9-35C6-A45B-B6B5215AC0D9"><!-- --></a>
<h3 class="sectiontitle">Typedef pid_t</h3>
<div class="section signature"><table class="signature"><tr><td>typedef 
					<a class="xref xref apiRelation" href="GUID-6B9FA9E3-BBBA-3B9F-8538-94583F2D3BA4.html">__pid_t</a>
</td><td>pid_t</td></tr></table></div><div class="section section apiDesc section apidesc">
</div>
<div class="topic reference apiRef apiOperation cxxDefine nested1" id="GUID-A787F2C9-E58F-342D-BD1E-B8EEB268586C"><a name="GUID-A787F2C9-E58F-342D-BD1E-B8EEB268586C"><!-- --></a>
<h3 class="sectiontitle">_PID_T_DECLARED</h3>
<div class="body refbody apiDetail apiOperationDetail cxxDefineDetail"><p class="shortdesc">
<div class="section section apiDesc section apidesc">
</div>
</p></div>
<div class="topic reference apiRef apiValue cxxTypedef nested1" id="GUID-BE25FFE1-646E-34EF-B1E7-CCAAB66666AF"><a name="GUID-BE25FFE1-646E-34EF-B1E7-CCAAB66666AF"><!-- --></a>
<h3 class="sectiontitle">Typedef size_t</h3>
<div class="section signature"><table class="signature"><tr><td>typedef 
					<a class="xref xref apiRelation" href="GUID-6B9FA9E3-BBBA-3B9F-8538-94583F2D3BA4.html">__size_t</a>
</td><td>size_t</td></tr></table></div><div class="section section apiDesc section apidesc">
</div>
<div class="topic reference apiRef apiOperation cxxDefine nested1" id="GUID-70E6211E-7ADA-33FD-B9D0-4E6335A159A2"><a name="GUID-70E6211E-7ADA-33FD-B9D0-4E6335A159A2"><!-- --></a>
<h3 class="sectiontitle">_SIZE_T_DECLARED</h3>
<div class="body refbody apiDetail apiOperationDetail cxxDefineDetail"><p class="shortdesc">
<div class="section section apiDesc section apidesc">
</div>
</p></div>
<div class="topic reference apiRef apiValue cxxTypedef nested1" id="GUID-D8609951-BC69-3A34-B01A-92FDBCC6CA0C"><a name="GUID-D8609951-BC69-3A34-B01A-92FDBCC6CA0C"><!-- --></a>
<h3 class="sectiontitle">Typedef ssize_t</h3>
<div class="section signature"><table class="signature"><tr><td>typedef 
					<a class="xref xref apiRelation" href="GUID-6B9FA9E3-BBBA-3B9F-8538-94583F2D3BA4.html">__ssize_t</a>
</td><td>ssize_t</td></tr></table></div><div class="section section apiDesc section apidesc">
</div>
<div class="topic reference apiRef apiOperation cxxDefine nested1" id="GUID-2E3DF392-81C9-3CF9-A975-29D90AE331AC"><a name="GUID-2E3DF392-81C9-3CF9-A975-29D90AE331AC"><!-- --></a>
<h3 class="sectiontitle">_SSIZE_T_DECLARED</h3>
<div class="body refbody apiDetail apiOperationDetail cxxDefineDetail"><p class="shortdesc">
<div class="section section apiDesc section apidesc">
</div>
</p></div>
<div class="topic reference apiRef apiValue cxxTypedef nested1" id="GUID-77F2BC7C-8164-32B5-9944-90C208562815"><a name="GUID-77F2BC7C-8164-32B5-9944-90C208562815"><!-- --></a>
<h3 class="sectiontitle">Typedef time_t</h3>
<div class="section signature"><table class="signature"><tr><td>typedef 
					<a class="xref xref apiRelation" href="GUID-6B9FA9E3-BBBA-3B9F-8538-94583F2D3BA4.html">__time_t</a>
</td><td>time_t</td></tr></table></div><div class="section section apiDesc section apidesc">
</div>
<div class="topic reference apiRef apiOperation cxxDefine nested1" id="GUID-B2FA5370-4959-35E7-8259-E9A8C7D6DA7E"><a name="GUID-B2FA5370-4959-35E7-8259-E9A8C7D6DA7E"><!-- --></a>
<h3 class="sectiontitle">_TIME_T_DECLARED</h3>
<div class="body refbody apiDetail apiOperationDetail cxxDefineDetail"><p class="shortdesc">
<div class="section section apiDesc section apidesc">
</div>
</p></div>
<div class="topic reference apiRef apiOperation cxxFunction nested1" id="GUID-D5FB47E6-AE24-35BF-910E-7C2FB2AE76F6"><a name="GUID-D5FB47E6-AE24-35BF-910E-7C2FB2AE76F6"><!-- --></a>
<a name="GUID-97F324DE-7016-347B-B7B8-0FB363E65C2C"><!-- --></a><h3 class="sectiontitle">msgget ( key_t, int )</h3>
<div class="body refbody apiDetail apiOperationDetail cxxFunctionDetail section functiondetail"><div class="section signature"><table class="signature"><tr><td>IMPORT_C int</td><td>msgget</td><td>(</td><td><a class="xref xref apiRelation" href="GUID-9AF632B1-1CBB-3174-89E1-839D5B6E2CC8.html">key_t</a></td><td><span class="parameter">key</span>,</td></tr><tr><td colspan="3"> </td><td>int</td><td><span class="parameter">msgflg</span></td></tr><tr><td colspan="2"> </td><td>)</td><td colspan="2"></td></tr></table></div><div class="section section apiDesc section apidesc">
<p class="p">The msgget function returns the message queue identifier associated with key. A message queue identifier is a unique integer greater than zero.</p>
<p class="p">A message queue is created if either key is equal to IPC_PRIVATE, or key does not have a message queue identifier associated with it and the IPC_CREAT bit is set in msgflg.</p>
<p class="p">If a new message queue is created, the data structure associated with it (the <a class="xref" href="GUID-8CE70314-2B44-3A63-8C53-B4256F11B1EE.html#GUID-8CE70314-2B44-3A63-8C53-B4256F11B1EE">msqid_ds</a> structure, see msgctl is initialized as follows: msg_perm.cuid and msg_perm.uid are set to the effective uid of the calling process. In the current implementation, uid is set to root. msg_perm.gid and msg_perm.cgid are set to the effective gid of the calling process. In the current implementation, gid is set to root. msg_perm.mode is set to the lower 9 bits of msgflg. msg_cbytes, msg_qnum, msg_lspid, msg_lrpid, msg_rtime, and msg_stime are set to 0. msg_qbytes is set to the system wide maximum value for the number of bytes in a queue (Dv MSGMNB). msg_ctime is set to the current time.</p>
<p class="p">Examples:</p>
<p class="p">Example code to create a message queue using msgget</p>
<div class="p">
<pre class="pre codeblock">#include &lt;sys/types.h&gt;
#include &lt;sys/ipc.h&gt;
#include &lt;sys/msg.h&gt;
#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
#include &lt;errno.h&gt;

#define MESSAGE_Q_KEY 1000

int main(void)
{
   int msq_id, len;
   struct {
       long mtype;
       char mtext[128];
   } msg_buf;
   /*
 Create a message queue with a given key
    */
    if ((msq_id = msgget(MESSAGE_Q_KEY, IPC_CREAT | IPC_EXCL | 0666)) == -1) {
       printf("Message Q create failed with errno %d
", errno);
       return -1;
    }
    msg_buf.mtype = 1; /* message identifier */
    strcpy(msg_buf.mtext, "some_data_to_send"); /* data */
    len = strlen(msg_buf.mtext)+1;
    /*
 Put the message in the queue
     */
    if (msgsnd(msq_id, (struct msgbuf *)&amp;msg;_buf, len, 0) == -1) {
        printf("Message Q send failed with errno %d
", errno);
    }
    return 0;
}</pre>
 Example code to return an existing message queue with msgget <pre class="pre codeblock">#include &lt;sys/types.h&gt;
#include &lt;sys/ipc.h&gt;
#include &lt;sys/msg.h&gt;
#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
#include &lt;errno.h&gt;

#define MESSAGE_Q_KEY 1000

int main(void)
{
   int msq_id;
   int msg_len = 128;
   int msg_type = 0; /* Any type of message */
   struct {
       long mtype;
       char mtext[128];
   } msg_buf;
   /*
 Get the message queue id for the given key
    */
    if ((msq_id = msgget(MESSAGE_Q_KEY, 0)) == -1) {
       printf("Message Q  get id failed with errno %d
", errno);
       return -1;
    }
    /*
 Get the message from the queue
     */
    if (msgrcv(msq_id, (struct msgbuf *)&amp;msg;_buf, msg_len, msg_type, 0) == -1) {
        printf("Message Q recv failed with errno %d
", errno);
    }
    /*
 Remove the message queue
     */
     if (msgctl(msq_id, IPC_RMID, NULL) == -1) {
       printf("Message Q  delete failed with errno %d
", errno);
       return -1;
     }
     return 0;
}</pre>
</div>
<p class="p">See also: <a class="xref" href="GUID-760B503E-26E1-39CB-82C2-AE1329D0E3A4.html#GUID-962ED6C6-16C0-339C-BE4F-E0AB5BB35D89">msgctl()</a> <a class="xref" href="GUID-760B503E-26E1-39CB-82C2-AE1329D0E3A4.html#GUID-8A5CAF1B-1A40-317A-999A-E25F71DAF959">msgrcv()</a> <a class="xref" href="GUID-760B503E-26E1-39CB-82C2-AE1329D0E3A4.html#GUID-32CAF48A-B38E-3D7A-80CC-6DBA7B02CA37">msgsnd()</a></p>
</div>
<div class="ph ph apiDefItem apiDefItem cxxFunctionParameters section parameters">
<div class="ph ph apiDefNote cxxFunctionReturnDesc section returnsdoc"><dl class="returnsdoc"><dt class="dlterm">Return Value</dt><dd>Upon successful completion a positive message queue identifier is returned. Otherwise, -1 is returned and the global variable errno is set to indicate the error.</dd></dl></div>
</div>
</div>
<div class="topic reference apiRef apiOperation cxxFunction nested1" id="GUID-32CAF48A-B38E-3D7A-80CC-6DBA7B02CA37"><a name="GUID-32CAF48A-B38E-3D7A-80CC-6DBA7B02CA37"><!-- --></a>
<a name="GUID-3EB59A23-46A5-3950-A7AF-C64514EFF518"><!-- --></a><h3 class="sectiontitle">msgsnd ( int, const void *, size_t, int )</h3>
<div class="body refbody apiDetail apiOperationDetail cxxFunctionDetail section functiondetail"><div class="section signature"><table class="signature"><tr><td>IMPORT_C int</td><td>msgsnd</td><td>(</td><td>int</td><td><span class="parameter">msqid</span>,</td></tr><tr><td colspan="3"> </td><td>const void *</td><td><span class="parameter">msgp</span>,</td></tr><tr><td colspan="3"> </td><td><a class="xref xref apiRelation" href="GUID-381654FC-8996-3621-93A3-636F88EE7207.html">size_t</a></td><td><span class="parameter">msgsz</span>,</td></tr><tr><td colspan="3"> </td><td>int</td><td><span class="parameter">msgflg</span></td></tr><tr><td colspan="2"> </td><td>)</td><td colspan="2"></td></tr></table></div><div class="section section apiDesc section apidesc">
<div class="p">The msgsnd function sends a message to the message queue specified in msqid. The msgp argument points to a structure containing the message. This structure should consist of the following members: <pre class="pre codeblock">long mtype;    /* message type */
char mtext[1]; /* body of message */</pre>
</div>
<p class="p">mtype is an integer greater than 0 that can be used for selecting messages (see msgrcv mtext is an array of bytes, with a size up to that of the system limit (Dv MSGMAX).</p>
<p class="p">If the number of bytes already on the message queue plus msgsz is bigger than the maximum number of bytes on the message queue (Va msg_qbytes, see msgctl or the number of messages on all queues system-wide is already equal to the system limit, msgflg determines the action of msgsnd. If msgflg has IPC_NOWAIT mask set in it, the call will return immediately. If msgflg does not have IPC_NOWAIT set in it, the call will block until:</p>
<p class="p">The condition which caused the call to block does no longer exist. The message will be sent. The message queue is removed, in which case -1 will be returned, and errno is set to EINVAL. After a successful call, the data structure associated with the message queue is updated in the following way:</p>
<p class="p">msg_cbytes is incremented by the size of the message. msg_qnum is incremented by 1. msg_lspid is set to the pid of the calling process. msg_stime is set to the current time.</p>
<div class="p">Examples: <pre class="pre codeblock">#include &lt;sys/types.h&gt;
#include &lt;sys/ipc.h&gt;
#include &lt;sys/msg.h&gt;
#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
#include &lt;errno.h&gt;

#define MESSAGE_Q_KEY 1000

int main(void)
{
   int msq_id, len;
   struct {
       long mtype;
       char mtext[128];
   } msg_buf;
   /*
 Create a message queue with the given key
    */
    if ((msq_id = msgget(MESSAGE_Q_KEY, IPC_CREAT | IPC_EXCL | 0666)) == -1) {
       printf("Message Q create failed with errno %d
", errno);
       return -1;
    }
    msg_buf.mtype = 1; /* message identifier */
    strcpy(msg_buf.mtext, "some_data_to_send"); /* data */
    len = strlen(msg_buf.mtext)+1;
    /*
 Put the message in the queue
     */
    if (msgsnd(msq_id, (struct msgbuf *)&amp;msg;_buf, len, 0) == -1) {
        printf("Message Q send failed with errno %d
", errno);
    }
    return 0;
}</pre>
</div>
</div>
<div class="ph ph apiDefItem apiDefItem cxxFunctionParameters section parameters">
<div class="ph ph apiDefNote cxxFunctionReturnDesc section returnsdoc"><dl class="returnsdoc"><dt class="dlterm">Return Value</dt><dd>The msgsnd function returns the value 0 if successful; otherwise the value -1 is returned and errno is set to indicate the error.</dd></dl></div>
</div>
</div>
<div class="topic reference apiRef apiOperation cxxFunction nested1" id="GUID-8A5CAF1B-1A40-317A-999A-E25F71DAF959"><a name="GUID-8A5CAF1B-1A40-317A-999A-E25F71DAF959"><!-- --></a>
<a name="GUID-F1D31BC3-74BF-30F7-AF01-E1DC07CA41B0"><!-- --></a><h3 class="sectiontitle">msgrcv ( int, void *, size_t, long, int )</h3>
<div class="body refbody apiDetail apiOperationDetail cxxFunctionDetail section functiondetail"><div class="section signature"><table class="signature"><tr><td>IMPORT_C <a class="xref xref apiRelation" href="GUID-A3742116-1D59-315C-9989-D2FC1E8E755C.html">ssize_t</a></td><td>msgrcv</td><td>(</td><td>int</td><td><span class="parameter">msqid</span>,</td></tr><tr><td colspan="3"> </td><td>void *</td><td><span class="parameter">msgp</span>,</td></tr><tr><td colspan="3"> </td><td><a class="xref xref apiRelation" href="GUID-381654FC-8996-3621-93A3-636F88EE7207.html">size_t</a></td><td><span class="parameter">msgsz</span>,</td></tr><tr><td colspan="3"> </td><td>long</td><td><span class="parameter">msgtyp</span>,</td></tr><tr><td colspan="3"> </td><td>int</td><td><span class="parameter">msgflg</span></td></tr><tr><td colspan="2"> </td><td>)</td><td colspan="2"></td></tr></table></div><div class="section section apiDesc section apidesc">
<div class="p">The msgrcv function receives a message from the message queue specified in msqid and places it into the structure pointed to by msgp. This structure should consist of the following members: <pre class="pre codeblock">long mtype;    /* message type */
char mtext[1]; /* body of message */</pre>
</div>
<p class="p">mtype is an integer greater than 0 that can be used for selecting messages, mtext is an array of bytes with a size up to that of the system limit (Dv MSGMAX).</p>
<p class="p">The value of msgtyp has one of the following meanings: The msgtyp argument is greater than 0. The first message of type msgtyp will be received. The msgtyp argument is equal to 0. The first message on the queue (of any message type) will be received. The msgtyp argument is less than 0. The first message of the lowest message type that is less than or equal to the absolute value of msgtyp will be received.</p>
<p class="p">The msgsz argument specifies the maximum length of the requested message. If the received message has a length greater than msgsz it will be silently truncated if the MSG_NOERROR flag is set in msgflg, otherwise an error will be returned.</p>
<p class="p">If no matching message is present on the message queue specified by msqid, the behavior of msgrcv depends on whether the IPC_NOWAIT flag is set in msgflg or not. If IPC_NOWAIT is set, msgrcv will immediately return a value of -1 and set errno to ENOMSG. If IPC_NOWAIT is not set, the calling process will be blocked until: A message of the requested type becomes available on the message queue. The message queue is removed, in which case -1 will be returned and errno set to EINVAL.</p>
<p class="p">If a message is successfully received, the data structure associated with msqid is updated as follows: msg_cbytes is decremented by the size of the message. msg_lrpid is set to the pid of the caller. msg_lrtime is set to the current time. msg_qnum is decremented by 1.</p>
<p class="p">Examples:</p>
<p class="p">Receive a message from the queue</p>
<div class="p">
<pre class="pre codeblock">#include &lt;sys/types.h&gt;
#include &lt;sys/ipc.h&gt;
#include &lt;sys/msg.h&gt;
#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
#include &lt;errno.h&gt;

#define MESSAGE_Q_KEY 1000

int main(void)
{
   int msq_id;
   int msg_len = 128;
   int msg_type = 0; /* Any type of message */
   struct {
       long mtype;
       char mtext[128];
   } msg_buf;
   int ret_val = -1;
   /*
 Get the message queue id for the given key
    */
    if ((msq_id = msgget(MESSAGE_Q_KEY, IPC_CREAT)) == -1) {
       printf("Message Q  get id failed with errno %d
", errno);
       return -1;
    }
    /*
 Get the message from the queue
     */
    if ((ret_val = msgrcv(msq_id, (struct msgbuf *)&amp;msg;_buf, msg_len, msg_type, 0)) == -1) {
        printf("Message Q recv failed with errno %d
", errno);
    }
    /*
 Remove the message queue
     */
     if (msgctl(msq_id, IPC_RMID, NULL) == -1) {
       printf("Message Q  delete failed with errno %d
", errno);
       return -1;
     }
     return ret_val;
}


 Send a message to the queue

#include &lt;sys/types.h&gt;
#include &lt;sys/ipc.h&gt;
#include &lt;sys/msg.h&gt;
#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
#include &lt;errno.h&gt;

#define MESSAGE_Q_KEY 1000

int main(void)
{
   int msq_id, len;
   struct {
       long mtype;
       char mtext[128];
   } msg_buf;
   /*
 Create a message queue with the given key
    */
    if ((msq_id = msgget(MESSAGE_Q_KEY, IPC_CREAT | IPC_EXCL | 0666)) == -1) {
       printf("Message Q create failed with errno %d0, errno);
       return -1;
    }
    msg_buf.mtype = 1; /* message identifier */
    strcpy(msg_buf.mtext, "some_data_to_send"); /* data */
    len = strlen(msg_buf.mtext)+1;
    /*
 Put the message in the queue
     */
    if (msgsnd(msq_id, (struct msgbuf *)&amp;msg;_buf, len, 0) == -1) {
        printf("Message Q send failed with errno %d
", errno);
    }
    return 0;
}</pre>
</div>
<p class="p">See also: <a class="xref" href="GUID-760B503E-26E1-39CB-82C2-AE1329D0E3A4.html#GUID-962ED6C6-16C0-339C-BE4F-E0AB5BB35D89">msgctl()</a> <a class="xref" href="GUID-760B503E-26E1-39CB-82C2-AE1329D0E3A4.html#GUID-D5FB47E6-AE24-35BF-910E-7C2FB2AE76F6">msgget()</a> <a class="xref" href="GUID-760B503E-26E1-39CB-82C2-AE1329D0E3A4.html#GUID-32CAF48A-B38E-3D7A-80CC-6DBA7B02CA37">msgsnd()</a></p>
</div>
<div class="ph ph apiDefItem apiDefItem cxxFunctionParameters section parameters">
<div class="ph ph apiDefNote cxxFunctionReturnDesc section returnsdoc"><dl class="returnsdoc"><dt class="dlterm">Return Value</dt><dd>Upon successful completion, msgrcv returns the number of bytes received into the mtext field of the structure pointed to by msgp. Otherwise, -1 is returned, and errno set to indicate the error.</dd></dl></div>
</div>
</div>
<div class="topic reference apiRef apiOperation cxxFunction nested1" id="GUID-962ED6C6-16C0-339C-BE4F-E0AB5BB35D89"><a name="GUID-962ED6C6-16C0-339C-BE4F-E0AB5BB35D89"><!-- --></a>
<a name="GUID-10115BE1-CC56-3261-9315-54A9D392637E"><!-- --></a><h3 class="sectiontitle">msgctl ( int, int, struct msqid_ds * )</h3>
<div class="body refbody apiDetail apiOperationDetail cxxFunctionDetail section functiondetail"><div class="section signature"><table class="signature"><tr><td>IMPORT_C int</td><td>msgctl</td><td>(</td><td>int</td><td><span class="parameter">msqid</span>,</td></tr><tr><td colspan="3"> </td><td>int</td><td><span class="parameter">cmd</span>,</td></tr><tr><td colspan="3"> </td><td>struct <a class="xref xref apiRelation" href="GUID-8CE70314-2B44-3A63-8C53-B4256F11B1EE.html">msqid_ds</a> *</td><td><span class="parameter">buf</span></td></tr><tr><td colspan="2"> </td><td>)</td><td colspan="2"></td></tr></table></div><div class="section section apiDesc section apidesc">
<p class="p">The msgctl system call performs some control operations on the message queue specified by msqid. Each message queue has a data structure associated with it, parts of which may be altered by msgctl and parts of which determine the actions of msgctl. The data structure is defined in &lt;<a class="xref" href="GUID-760B503E-26E1-39CB-82C2-AE1329D0E3A4.html#GUID-760B503E-26E1-39CB-82C2-AE1329D0E3A4">sys/msg.h</a>&gt; and contains (amongst others) the following members:</p>
<div class="p">
<pre class="pre codeblock">struct msqid_ds {
        struct  ipc_perm msg_perm;      /* msg queue permission bits */
        struct  msg *msg_first; /* first message in the queue */
        struct  msg *msg_last;  /* last message in the queue */
        u_long  msg_cbytes;     /* number of bytes in use on the queue */
        u_long  msg_qnum;       /* number of msgs in the queue */
        u_long  msg_qbytes;     /* max # of bytes on the queue */
        pid_t   msg_lspid;      /* pid of last msgsnd() */
        pid_t   msg_lrpid;      /* pid of last msgrcv() */
        time_t  msg_stime;      /* time of last msgsnd() */
        long    msg_pad1;
        time_t  msg_rtime;      /* time of last msgrcv() */
        long    msg_pad2;
        time_t  msg_ctime;      /* time of last msgctl() */
        long    msg_pad3;
        long    msg_pad4[4];
};</pre>
</div>
<div class="p">The <a class="xref" href="GUID-A931EA95-C3BB-3A6F-8E20-62C757E48CB4.html#GUID-A931EA95-C3BB-3A6F-8E20-62C757E48CB4">ipc_perm</a> structure used inside the <a class="xref" href="GUID-6150225A-D6EA-3068-B5FB-6AEFD532F902.html#GUID-6150225A-D6EA-3068-B5FB-6AEFD532F902">shmid_ds</a> structure is defined in &lt;<a class="xref" href="GUID-9AF632B1-1CBB-3174-89E1-839D5B6E2CC8.html#GUID-9AF632B1-1CBB-3174-89E1-839D5B6E2CC8">sys/ipc.h</a>&gt; and looks like this: <pre class="pre codeblock">struct ipc_perm {
        ushort  cuid;   /* creator user id */
        ushort  cgid;   /* creator group id */
        ushort  uid;    /* user id */
        ushort  gid;    /* group id */
        ushort  mode;   /* r/w permission */
        ushort  seq;    /* sequence # (to generate unique msg/sem/shm id) */
        key_t   key;    /* user specified msg/sem/shm key */
};</pre>
</div>
<p class="p">The operation to be performed by msgctl is specified in cmd and is one of: IPC_STAT Gather information about the message queue and place it in the structure pointed to by buf. IPC_SET Set the value of the msg_perm.uid, msg_perm.gid, msg_perm.mode and msg_qbytes fields in the structure associated with msqid. The values are taken from the corresponding fields in the structure pointed to by buf. Values for msg_qbytes that exceed the system limit (MSGMNB from &lt;<a class="xref" href="GUID-760B503E-26E1-39CB-82C2-AE1329D0E3A4.html#GUID-760B503E-26E1-39CB-82C2-AE1329D0E3A4">sys/msg.h</a>&gt;) are silently truncated to that limit. IPC_RMID Remove the message queue specified by msqid and destroy the data associated with it.</p>
<p class="p">The permission to read from or write to a message queue (see msgsnd and msgrcv is determined by the msg_perm.mode field in the same way as is done with files (see chmod)</p>
<div class="p">Examples: <pre class="pre codeblock">#include &lt;sys/types.h&gt;
#include &lt;sys/ipc.h&gt;
#include &lt;sys/msg.h&gt;
#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
#include &lt;errno.h&gt;

#define MESSAGE_Q_KEY 1000

int main(void)
{
   int msq_id, len;
   struct {
       long mtype;
       char mtext[128];
   } msg_buf;
   /*
 Create a message queue with a given key
    */
    if ((msq_id = msgget(MESSAGE_Q_KEY, IPC_CREAT | IPC_EXCL | 0666)) == -1) {
       printf("Message Q create failed with errno %d
", errno);
       return -1;
    }
    msg_buf.mtype = 1; /* message identifier */
    strcpy(msg_buf.mtext, "some_data_to_send"); /* data */
    len = strlen(msg_buf.mtext)+1;
    /*
 Put the message in the queue
     */
    if (msgsnd(msq_id, (struct msgbuf *)&amp;msg;_buf, len, 0) == -1) {
        printf("Message Q send failed with errno %d
", errno);
    }
    return 0;
}</pre>
<pre class="pre codeblock">#include &lt;sys/types.h&gt;
#include &lt;sys/ipc.h&gt;
#include &lt;sys/msg.h&gt;
#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
#include &lt;errno.h&gt;

#define MESSAGE_Q_KEY 1000

int main(void)
{
   int msq_id;
   int msg_len = 128;
   int msg_type = 0; /* Any type of message */
   struct {
       long mtype;
       char mtext[128];
   } msg_buf;
   /*
 Get the message queue id for the given key
    */
    if ((msq_id = msgget(MESSAGE_Q_KEY, 0)) == -1) {
       printf("Message Q  get id failed with errno %d
", errno);
       return -1;
    }
    /*
 Get the message from the queue
     */
    if (msgrcv(msq_id, (struct msgbuf *)&amp;msg;_buf, msg_len, msg_type, 0) == -1) {
        printf("Message Q recv failed with errno %d
", errno);
    }
    /*
 Remove the message queue
     */
     if (msgctl(msq_id, IPC_RMID, NULL) == -1) {
       printf("Message Q  delete failed with errno %d
", errno);
       return -1;
     }
     return 0;
}</pre>
</div>
<div class="p">Note :The below data members of the structure <a class="xref" href="GUID-8CE70314-2B44-3A63-8C53-B4256F11B1EE.html#GUID-8CE70314-2B44-3A63-8C53-B4256F11B1EE">msqid_ds</a> are internal components. <pre class="pre codeblock">	struct  msg *msg_first
	struct  msg *msg_last; 
	long    msg_pad1;
	long    msg_pad2;
	long    msg_pad3;
	long    msg_pad4[4];</pre>
 and are not filled if msgctl is called with the flag IPC_STAT.</div>
<p class="p">
</p><p class="p">See also: <a class="xref" href="GUID-760B503E-26E1-39CB-82C2-AE1329D0E3A4.html#GUID-D5FB47E6-AE24-35BF-910E-7C2FB2AE76F6">msgget()</a> <a class="xref" href="GUID-760B503E-26E1-39CB-82C2-AE1329D0E3A4.html#GUID-8A5CAF1B-1A40-317A-999A-E25F71DAF959">msgrcv()</a> <a class="xref" href="GUID-760B503E-26E1-39CB-82C2-AE1329D0E3A4.html#GUID-32CAF48A-B38E-3D7A-80CC-6DBA7B02CA37">msgsnd()</a></p>
</div>
<div class="ph ph apiDefItem apiDefItem cxxFunctionParameters section parameters">
<div class="ph ph apiDefNote cxxFunctionReturnDesc section returnsdoc"><dl class="returnsdoc"><dt class="dlterm">Return Value</dt><dd>The msgctl function returns the value 0 if successful; otherwise the value -1 is returned and errno is set to indicate the error.</dd></dl></div>
</div>
</div>
</div></div><div class="footer"><hr /><div class="copy">Â© Nokia 2005.</div></div>
</div></div></div></div></div></div></div></div></div></div></div></div></p></div></div></div></body>
<!-- Mirrored from devlib.symbian.slions.net/belle/GUID-C6E5F800-0637-419E-8FE5-1EBB40E725AA/GUID-760B503E-26E1-39CB-82C2-AE1329D0E3A4.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 27 Mar 2020 04:21:44 GMT -->
</html>