
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<!-- Mirrored from devlib.symbian.slions.net/s3/GUID-204627D4-3818-5DE7-8969-C335DBA5B153.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 27 Mar 2020 06:10:49 GMT -->
<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><meta name="copyright" content="(C) Copyright 2011" /><meta name="DC.rights.owner" content="(C) Copyright 2011" /><meta name="DC.Type" content="concept" /><meta name="DC.Title" content="File management with CFileMan" /><meta name="abstract" content="This topic describes the overview, how to use cFileman and few important points about file management." /><meta name="description" content="This topic describes the overview, how to use cFileman and few important points about file management." /><meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7" /><meta name="DC.Relation" scheme="URI" content="GUID-E3D2A6ED-8192-563D-8966-DD96B3AF1783" /><meta name="DC.Relation" scheme="URI" content="GUID-0DF9E318-BE97-531E-AB39-A7B5E8787C87" /><meta name="DC.Relation" scheme="URI" content="GUID-BB9760B4-4F3F-5326-81FB-B644C82F0E65" /><meta name="DC.Relation" scheme="URI" content="GUID-198DCED1-F429-5C95-A51D-53AE416687E8" /><meta name="DC.Relation" scheme="URI" content="GUID-ACF6C0A2-87ED-55B3-B22A-9B331D9940AC" /><meta name="DC.Format" content="XHTML" /><meta name="DC.Identifier" content="GUID-204627D4-3818-5DE7-8969-C335DBA5B153" /><meta name="DC.Language" content="en" /><title>File
management with CFileMan </title><link href="css/s60/style.css" rel="stylesheet" type="text/css" /><link href="PLUGINS_ROOT/com.nokia.forum.library/css/category_design.html" rel="stylesheet" type="text/css" /></head><body><div class="body"><div class="contentLeft prTxt"><h1 class="pageHeading" id="GUID-204627D4-3818-5DE7-8969-C335DBA5B153">File
management with CFileMan</h1><div><p>This topic describes the overview, how to use cFileman and few
important points about file management.</p>
<div id="GUID-BE295C9C-37BC-5CCE-9957-4DD5D0DF0672"><h3 class="section-title">Overview</h3> <p>The <a href="GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-82CEC14F-1479-3922-846A-9FCDB6465EF7.html#GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-82CEC14F-1479-3922-846A-9FCDB6465EF7.html"><code class="apiname">CFileMan</code></a> class
provides file management functionality, but unlike the corresponding functionality
provided by class <a href="GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-E263C747-946F-35AA-9F1D-41833BD350FC.html#GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-E263C747-946F-35AA-9F1D-41833BD350FC.html"><code class="apiname">RFs</code></a>, <code class="codeph">CFileMan</code> can operate
on files and directories located throughout a directory hierarchy. </p> <p> <code class="codeph">CFileMan</code> lets
you: </p> <ul>
<li id="GUID-009066F1-2047-5BEF-A3A0-FB4FC341753D"><a name="GUID-009066F1-2047-5BEF-A3A0-FB4FC341753D"><!-- --></a><p>copy files </p> </li>
<li id="GUID-4777CAC8-8537-5AF6-87D0-D9C2AAE9DAB4"><a name="GUID-4777CAC8-8537-5AF6-87D0-D9C2AAE9DAB4"><!-- --></a><p>move files </p> </li>
<li id="GUID-7DA9BBBD-49E8-59F4-8A7C-B6C8D06FA981"><a name="GUID-7DA9BBBD-49E8-59F4-8A7C-B6C8D06FA981"><!-- --></a><p>delete files </p> </li>
<li id="GUID-03AF9640-CAC3-58F0-9FB3-A9227505D50B"><a name="GUID-03AF9640-CAC3-58F0-9FB3-A9227505D50B"><!-- --></a><p>rename files </p> </li>
<li id="GUID-44356ACA-0562-5B1D-BFE6-3ED20275FFBA"><a name="GUID-44356ACA-0562-5B1D-BFE6-3ED20275FFBA"><!-- --></a><p>delete directories and
their contained files and sub-directories </p> </li>
<li id="GUID-7703AEF1-64EE-54C5-8DD5-6F5D67B59A68"><a name="GUID-7703AEF1-64EE-54C5-8DD5-6F5D67B59A68"><!-- --></a><p>set and clear file attributes. </p> </li>
</ul> <p>The functions provided by the class accept the use of wildcards,
and means that some operations may take time to complete. The class, however,
provides both synchronous and asynchronous variants. </p> <p>All of the file
manipulation functions except <code class="codeph">Rename()</code> can operate recursively,
and all can operate non-recursively. When operating recursively, these functions
will act on all matching files located throughout the source directory's hierarchy.
When operating non-recursively, these functions act upon files contained in
the single top level source directory only. Recursion is set or unset using
the switch parameter to these functions. </p> </div>
<div id="GUID-EC9DAE8B-FB85-5E7F-925F-B03D2F1D584D"><h3 class="section-title">Using CFileMan</h3> <p>Typically,
a <a href="GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-82CEC14F-1479-3922-846A-9FCDB6465EF7.html#GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-82CEC14F-1479-3922-846A-9FCDB6465EF7.html"><code class="apiname">CFileMan</code></a> operation can result in a number of file/directory
manipulation operations, especially if wild cards are used. Some operations,
such as copying files, can take a (relatively) long time, especially if such
files are large. </p> <p>Symbian platform provides a file notification observer
interface that you can implement to provide notification of events resulting
from <code class="codeph">CFileMan</code> operations. The interface is defined by the <a href="GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-E608485F-B3E3-3310-A80E-169D8B9D2234.html#GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-E608485F-B3E3-3310-A80E-169D8B9D2234.html"><code class="apiname">MFileManObserver</code></a> class,
and you provide an implementation for the functions: </p> <ul>
<li id="GUID-EFEAD891-17C8-56E9-9D1B-89E26CC60AD4"><a name="GUID-EFEAD891-17C8-56E9-9D1B-89E26CC60AD4"><!-- --></a><p> <a href="GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-E608485F-B3E3-3310-A80E-169D8B9D2234.html#GUID-54D77B42-2AD9-3F82-89A7-3E651FAC2670"><code class="apiname">MFileManObserver::NotifyFileManStarted()</code></a> </p> </li>
<li id="GUID-012EAF53-723B-5A60-822B-B33F8BEE3F1B"><a name="GUID-012EAF53-723B-5A60-822B-B33F8BEE3F1B"><!-- --></a><p> <a href="GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-E608485F-B3E3-3310-A80E-169D8B9D2234.html#GUID-8D17D294-DE4A-3382-A832-9D318F522DE6"><code class="apiname">MFileManObserver::NotifyFileManOperation()</code></a> </p> </li>
<li id="GUID-41626506-7665-5931-A3BA-931A863486AC"><a name="GUID-41626506-7665-5931-A3BA-931A863486AC"><!-- --></a><p> <a href="GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-E608485F-B3E3-3310-A80E-169D8B9D2234.html#GUID-A73812AF-0877-3322-90C9-8A8F43708C8E"><code class="apiname">MFileManObserver::NotifyFileManEnded()</code></a>. </p> </li>
</ul> <p>Symbian platform calls the notification functions before or after
each file or directory entry has been processed, or during a file copy or
move operation. You can use the notification to provide information about
the state of the operation, such as error codes, the names of the target and
destination files, and the number of bytes transferred during a copy operation.
This information is available to your implementation by calling the public
functions in <a href="GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-82CEC14F-1479-3922-846A-9FCDB6465EF7.html#GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-82CEC14F-1479-3922-846A-9FCDB6465EF7.html"><code class="apiname">CFileMan</code></a> and its base class <a href="GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-C1C0C7F9-2665-3475-B70F-61C41291BB4D.html#GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-C1C0C7F9-2665-3475-B70F-61C41291BB4D.html"><code class="apiname">CFileBase</code></a>: </p> <ul>
<li id="GUID-F374F903-8456-57E0-B990-50ADEDB62CC8"><a name="GUID-F374F903-8456-57E0-B990-50ADEDB62CC8"><!-- --></a><p> <a href="GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-C1C0C7F9-2665-3475-B70F-61C41291BB4D.html#GUID-5EAB13D4-F93B-388B-92DE-F1987FBF2967"><code class="apiname">CFileBase::GetLastError()</code></a> </p> </li>
<li id="GUID-473260BD-F9E1-54B2-BB2B-6D0DB397B774"><a name="GUID-473260BD-F9E1-54B2-BB2B-6D0DB397B774"><!-- --></a><p> <a href="GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-C1C0C7F9-2665-3475-B70F-61C41291BB4D.html#GUID-96D7B25A-DFF6-3D30-86E0-1393EE0EA301"><code class="apiname">CFileBase::GetMoreInfoAboutError()</code></a> </p> </li>
<li id="GUID-86E140C6-A65E-524D-B40C-8D22A3174217"><a name="GUID-86E140C6-A65E-524D-B40C-8D22A3174217"><!-- --></a><p> <a href="GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-82CEC14F-1479-3922-846A-9FCDB6465EF7.html#GUID-4D489875-CAAB-3022-BE81-DF53B961BD9E"><code class="apiname">CFileMan::CurrentAction()</code></a> </p> </li>
<li id="GUID-18116CCF-BEF7-5B47-B6C8-F08C8E2DE8D2"><a name="GUID-18116CCF-BEF7-5B47-B6C8-F08C8E2DE8D2"><!-- --></a><p> <a href="GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-82CEC14F-1479-3922-846A-9FCDB6465EF7.html#GUID-9DB0E0B7-7100-3FB1-81FA-1075E6E9E609"><code class="apiname">CFileMan::GetCurrentTarget()</code></a> </p> </li>
<li id="GUID-F3100AE7-4234-5B9C-9F29-C46EC74B6408"><a name="GUID-F3100AE7-4234-5B9C-9F29-C46EC74B6408"><!-- --></a><p> <a href="GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-82CEC14F-1479-3922-846A-9FCDB6465EF7.html#GUID-CF653BC4-8480-3774-AD87-05E4DDCBC1DE"><code class="apiname">CFileMan::GetCurrentSource()</code></a> </p> </li>
<li id="GUID-F2C0B561-6E6C-5223-8428-026D56125807"><a name="GUID-F2C0B561-6E6C-5223-8428-026D56125807"><!-- --></a><p> <a href="GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-82CEC14F-1479-3922-846A-9FCDB6465EF7.html#GUID-351464A4-E108-39C4-9F40-6C099DC89F0A"><code class="apiname">CFileMan::BytesTransferredByCopyStep()</code></a> </p> </li>
</ul> <p>You can also use the notification function to cancel, retry or continue
processing a file or directory, or to abort the whole operation, by returning
a suitable <a href="GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-E608485F-B3E3-3310-A80E-169D8B9D2234.html#GUID-077D82DD-0D4F-38DB-B2F9-EDE6806DBA7A"><code class="apiname">MFileManObserver::TControl</code></a> value. </p> <p>This
mechanism provides a way for an application to provide feedback, or to give
control over such operations to an end-user through its user interface. </p> <p><strong>Example code (1)</strong> </p> <p>The following example code shows how you
might use this. It is not a complete example, but it gives you an idea of
what's possible. The example attempts to copy all files from directory <code>C:\path1</code> to <code>c:\path2</code> synchronously. </p> <p>You would need to elaborate on this to make it part of a real application,
and you would probably need the use of active objects, especially if using
the asynchronous versions of the <code class="codeph">CFileMan</code> functions. </p> <pre class="codeblock">    ...
    _LIT(KSourcePath,"C:\\path1\\*.*");
    _LIT(KDestinationPath,"C:\\path2");

    // Connect session
    RFs fsSession;
    User::LeaveIfError(fsSession.Connect()); 
    
    // Create file management object
    CFileMan* fileMan = CFileMan::NewL(fsSession);
    CleanupStack::PushL(fileMan); 

    // Create file management notification object and set to observe
    TFileCopyProgressMonitor fileCopyProgressMonitor(*fileMan);
    fileMan-&gt;SetObserver(&amp;fileCopyProgressMonitor);
    
    // Do copy (here synchronously)
    fileMan-&gt;Copy(KSourcePath,KDestinationPath);
    
    // Clean up
    CleanupStack::PopAndDestroy(); 
    
    // close file server session
    fsSession.Close();
    ...
    </pre> <pre class="codeblock">class TFileCopyProgressMonitor : public MFileManObserver
    {
public :
    TFileCopyProgressMonitor(CFileMan&amp; aFileMan);
public : // implement the interface
    TControl NotifyFileManStarted();
    TControl NotifyFileManOperation();
    TControl NotifyFileManEnded();
public :
    CFileMan&amp; iFileMan;
    }
     </pre> <pre class="codeblock">TFileCopyProgressMonitor::TFileCopyProgressMonitor(CFileMan&amp; aFileMan)
    :iFileMan(aFileMan)
    {    
    }

// Called when a copy operation started
MFileManObserver::TControl TFileCopyProgressMonitor::NotifyFileManStarted()
    {
    TFileName&amp; aFile
    
    // Get name of file we are copying.
    // you might want to do something with this, such as display in a UI,
    // or save in a data member of this object for later use.
    iFileMan.GetCurrentSource(aFile);

    // Allow the operation to continue.
    return EContinue;
    }

// Called while a copy operation is in progress
MFileManObserver::TControl TFileCopyProgressMonitor::NotifyFileManOperation()
    {
    TInt bytesTransferred;
    
    // number of bytes copied so far for the file. 
    bytesbytesTransferred = iFileMan.BytesTransferredByCopyStep();
    
    // Allow the operation to continue.
    // You would choose to do something different; for example, you could 
    // return ECancel to cancel the operation if you had a reason to do so,
    return EContinue;
    }
    
// Called when a copy operation is complete
MFileManObserver::TControl TFileCopyProgressMonitor::NotifyFileManEnded()
    {
    TInt lasterror;
    
    // Allow operations to continue if all is well. 
    lasterror = iFileMan.GetLastError();
    if (lasterror == KErrNone)
        {
        return EContinue;
        }
    
    // Operation has not completed properly, so you might want to get
    // more information, and proceed accordingly.
    TFileManError filemanerror;
    
    filemanerror = iFileMan.GetMoreInfoAboutError();
    if (filemanerror==ESrcOpenFailed)
        {
        ...
        return EAbort;
        }
        
    if (filemanerror==ETrgOpenFailed)
        {
        ...
        return EAbort;
        }
      
    ... // you might want to check for other conditions etc.
    }
     </pre> <p><strong>Example
code (1)</strong> </p> <p>This code fragment shows a use of the <a href="GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-82CEC14F-1479-3922-846A-9FCDB6465EF7.html#GUID-53411800-9145-38CA-8C8C-B8C6F97E8FEE"><code class="apiname">CFileMan::Attribs()</code></a> functions. </p> <pre class="codeblock">_LIT(KDirText,"\\TopDir\\");
...
fileMan.Attribs(KDirText,KEntryAttHidden|KEntryAttReadOnly,
    KEntryAttArchive,TTime(0),CFileMan::ERecurse);
...</pre> <p>This sets the hidden and read-only attributes, and clears
the archive attribute for all files located in the hierarchy below <code>\TopDir\</code>.
The time of their last modification will be unchanged. </p> </div>
<div id="GUID-41F2D8B1-8350-533F-B8BA-4583A6E1C695"><h3 class="section-title">Notes</h3> <ol id="GUID-D1790FF2-8C3C-55ED-98D8-D095227D5B83">
<li id="GUID-602606F3-D537-580F-BEB7-1E25F1760B8A"><a name="GUID-602606F3-D537-580F-BEB7-1E25F1760B8A"><!-- --></a><p>If you use <a href="GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-82CEC14F-1479-3922-846A-9FCDB6465EF7.html#GUID-9456C8B9-C975-356C-B3A4-755928DE2AC3"><code class="apiname">CFileMan::Move()</code></a>,
be aware that the behaviour of this operation is sensitive to the presence
(or absence) of a trailing backslash ("\") character on the end of the source
path: </p> <ul>
<li id="GUID-E542B9BE-888B-55DE-95A1-A9B00810FD11"><a name="GUID-E542B9BE-888B-55DE-95A1-A9B00810FD11"><!-- --></a><p>if there is a trailing
backslash ("\") character, then the operation moves the content of the last
directory level only. </p> </li>
<li id="GUID-C6A158E1-612C-596D-8C26-88377E3B7AC1"><a name="GUID-C6A158E1-612C-596D-8C26-88377E3B7AC1"><!-- --></a><p>if there is no trailing
backslash ("\") character, then the operation moves both the last directory
level and its content, but note that you also need to specify <a href="GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-82CEC14F-1479-3922-846A-9FCDB6465EF7.html#GUID-8FD6F114-0D4C-3701-ACCF-4748129B1F79"><code class="apiname">CFileMan::ERecurse</code></a> in
the switches passed to the function. </p> </li>
</ul> <p>For example, if the directory level "b" contains the files <code>F1</code>, <code>F2</code> and <code>F3</code>,
then: </p> <pre class="codeblock">CFileMan fm;
...
fm-&gt;Move(_L("C:\a\b\"), _L("C:\x\y\"), CFileMan::ERecurse);</pre> <p>results
in files <code>F1</code>, <code>F2</code> and <code>F3</code> being
moved from <code>C:\a\b</code> to <code>C:\x\y</code>, leaving
the path <code>C:\a\b</code> unchanged, except that it no longer contains
the files <code>F1</code>, <code>F2</code> and <code>F3</code>. </p> <p>If
there is no trailing backslash character, for example: </p> <pre class="codeblock">CFileMan fm;
...
fm-&gt;Move(_L("C:\a\b"), _L("C:\x\y\"), CFileMan::ERecurse);</pre> <p>then
both the directory level "b" and its contents are moved. This means that there
is no longer a directory "b" under <code>C:\\a</code>. Instead there
is a new directory structure <code>C:\x\y\b</code> and the files <code>F1</code>, <code>F2</code> and <code>F3</code> now exist under <code>C:\x\y\b</code>. Also if "b" contains subdirectories,
then these are also moved along with "b". </p> </li>
<li id="GUID-3CAC4CA6-AB36-56AC-81AB-032DF70D99B7"><a name="GUID-3CAC4CA6-AB36-56AC-81AB-032DF70D99B7"><!-- --></a><p>If you use <a href="GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-82CEC14F-1479-3922-846A-9FCDB6465EF7.html#GUID-633C2FF5-4077-346D-B7B6-4CC04F887D7B"><code class="apiname">CFileMan::Copy()</code></a>,
the behaviour of this function does <em>not</em> depend on the presence or absence
of a trailing backslash ("\") character on the end of the source path. This
pattern of behaviour is in <em>contrast</em> to that of <a href="GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-82CEC14F-1479-3922-846A-9FCDB6465EF7.html#GUID-9456C8B9-C975-356C-B3A4-755928DE2AC3"><code class="apiname">CFileMan::Move()</code></a>.
You can only copy the content of the source path. You cannot request that
the last directory level plus its content be copied to the target path, by
adding a trailing backslash ("\") character onto the end of the source path.
This means that both of the following copy operations produce identical results: </p> <pre class="codeblock">CFileMan fm;
...
fm-&gt;Copy(_L("C:\a\b\"), _L("C:\x\y\"), CFileMan::ERecurse);
fm-&gt;Copy(_L("C:\a\b"), _L("C:\x\y\"), CFileMan::ERecurse);</pre> </li>
<li id="GUID-A17CB3FD-39BA-5D57-816B-1AB70C746E3F"><a name="GUID-A17CB3FD-39BA-5D57-816B-1AB70C746E3F"><!-- --></a><p>It is possible to pass KNullDesC,
the null (or empty) descriptor, to the <a href="GUID-251A35C1-CC66-4DE4-9EBE-964026E89E7F/GUID-82CEC14F-1479-3922-846A-9FCDB6465EF7.html#GUID-71056B22-AC2A-3E91-8896-8A6F2FB9B619"><code class="apiname">CFileMan::Delete()</code></a> functions
as the path name. Although you might expect these functions to treat this
as a null request, i.e. to delete nothing, they interpret the null descriptor
as the string <code>\*.*</code>. </p> </li>
</ol> </div>
</div></div></div><div class="footer"><p class="metadata">Last updated February 4th, 2010</p><hr /><div class="copy">Â© Nokia 2011.</div></div></body>
<!-- Mirrored from devlib.symbian.slions.net/s3/GUID-204627D4-3818-5DE7-8969-C335DBA5B153.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 27 Mar 2020 06:10:49 GMT -->
</html>